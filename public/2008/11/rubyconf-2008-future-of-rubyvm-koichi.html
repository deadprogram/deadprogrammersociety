<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RubyConf 2008 - Future of RubyVM - Koichi Sasada - Dead Programmer SOciety</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/favicon.png">
  <link rel="canonical" href="/2008/11/rubyconf-2008-future-of-rubyvm-koichi.html" />

  
  
  <link rel="stylesheet" href="/css/style.min.6b89cc86c0b843a772cdd6c6a8b7e11c2116c7933f6163d2ef225a87e1d2c121.css">
  

  
    
    <meta property="og:title" content="RubyConf 2008 - Future of RubyVM - Koichi Sasada"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="/2008/11/rubyconf-2008-future-of-rubyvm-koichi.html"/>
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@deadprogram"/>
    <meta name="twitter:creator" content="@deadprogram"/>
  

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet"> 
</head>




<body class='page frame page-blog-single'>
  <div id="menu-main-mobile" class="menu-main-mobile">
    <ul class="menu">
        
        
            
                <li class="menu-item-home">
                    <a href="/">Home</a>
                </li>
            
        
            
                <li class="menu-item-blog">
                    <a href="/posts/">Blog</a>
                </li>
            
        
            
                <li class="menu-item-about">
                    <a href="/about/">About</a>
                </li>
            
        
            
                <li class="menu-item-tags">
                    <a href="/tags/">Tags</a>
                </li>
            
        
    </ul>
</div>
  <div id="wrapper" class="wrapper">
    <div class='header'>
  <a class="header-logo" href="/">Dead Programmer SOciety</a>
  <div class="menu-main">
    <ul>
      
      
      
      
      <li class="menu-item-home ">
        <a href="/">
          
          <span>Home</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-blog ">
        <a href="/posts/">
          
          <span>Blog</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-about ">
        <a href="/about/">
          
          <span>About</span>
        </a>
      </li>
      
      
      
      <li class="menu-item-tags ">
        <a href="/tags/">
          
          <span>Tags</span>
        </a>
      </li>
      
    </ul>
  </div>
  <div id="toggle-menu-main-mobile" class="hamburger-trigger">
    <button class="hamburger">Menu</button>
  </div>
</div>
    
  <div class="blog">
    
    <div class="intro">
      <h1>RubyConf 2008 - Future of RubyVM - Koichi Sasada<span class="dot">.</span></h1>
      
    </div>
    <div class="content">
      <p><a href="http://www.atariage.com/2600/hacks/screenshots/s_YarVsYar_Hack_3.png"><img src="http://www.atariage.com/2600/hacks/screenshots/s_YarVsYar_Hack_3.png" alt=""></a>The first session I attended at RubyConf 2008 was called &ldquo;Future of RubyVM&rdquo;, and it began my ascent into &ldquo;VM Wonkiness&rdquo; as I started to call it. <a href="http://en.wikipedia.org/wiki/YARV">Koichi-san</a> is responsible for leading the team of Ruby 1.9 implementers, and is the authoritative source of info on its status. I was hoping to learn a few things, as well as to run into new acquaintance <a href="http://rubyforge.org/users/nobu/">Nobuyoshi Nakada</a>, one of the core team members.</p>
<p>Techniques for VM Performance<br>
- Simple techniques<br>
- C level VM</p>
<p>- Advanced techniques<br>
- Dynamic code generation<br>
- Native compilation<br>
- JIT compilation<br>
- Polymorphic inline cache<br>
- Selective inlining</p>
<p>- Online feedback opt.<br>
- Hotspot JIT<br>
- Tracing JIT</p>
<p>Pros/Cons of JRuby/IronRuby<br>
- Using an awesome VM<br>
- Pros<br>
- Many clever people working on the project<br>
- No code is good code<br>
- Many libraries already exist on each environment<br>
- Easy to use parallelism<br>
- Cons<br>
- Not only focused on ruby, so there is a semantics gap.<br>
- Cannot use C ext direct</p>
<p>Pros/Cons of <a href="http://rubini.us/">Rubinius</a><br>
- Most code in ruby<br>
- Pros<br>
- Ruby in Ruby<br>
- Says this is the *best way* to improve performance in the long run because we can easily analyze and make specific performance improvements.<br>
- Cons<br>
- Still a LONG way to get a high performance VM</p>
<p>Pros/Cons of C Ruby<br>
- Pros<br>
- Portability, using GCC<br>
- C is well known language already<br>
- Extensibility<br>
- Performance improvement<br>
- Easy to write simple extensions.<br>
Cons of C Ruby<br>
- Extension libraries are written in C<br>
- GC problem<br>
- Inlining problem<br>
- Limitations on program analysis</p>
<p>Our Performance Policy<br>
- CRuby is not best solution, but it is a GOOD one<br>
- They continue to improve the CRuby implementation<br>
- It is a pragmatic, practical selection<br>
- It will be the main implementation still for at least several years</p>
<p>Keywords for Success<br>
- Embedding<br>
- Parallelism</p>
<p>Research<br>
The team is working on taking advantage of C some projects are running<br>
- Hidden optimization techniques on YARV<br>
- Ricsin</p>
<p>Hidden Optimization Techniques<br>
- turned off in 1.9.1 by default<br>
- Tail call optimization<br>
- Optimizing using unification<br>
- Stack caching</p>
<p>- Left easy optimizations<br>
- Efficient method caching<br>
- Efficient fiber implementation using platform dependent way suvh as makcontext()<br>
- These optimizations will be merged in 1.9.2</p>
<p>Ricsin; Mix-in C Ruby<br>
- Embed part of a C program into ruby<br>
- Like a RubyInline, but directly embedded<br>
- Usage<br>
- Use C libs direct<br>
- Replace all built-in classes and methods<br>
- Test Ruby C API<br>
- Continuous performance improvements</p>
<p>Ruby to C AOT Compiler<br>
- Translate Ruby scripts to C code ahead of time</p>
<p>Related work<br>
- <a href="http://rubyforge.org/projects/ruby2c/">ruby2c</a><br>
- <a href="http://d.hatena.ne.jp/rubynews/20080525/1211730562">yajit</a><br>
- <a href="http://github.com/miura1729/yarv2llvm/tree/master">yarv2llvm</a></p>
<p>Atomic-Ruby project<br>
- Issue: ruby is too fat<br>
- EMBEDDED<br>
- Embedded system can have special problems, such as resource limitations<br>
- Application embedded ruby<br>
- Some applications need just a Ruby DSL engine, not the full ruby distribution.<br>
- We need a slim Ruby interpreter<br>
- Utilize CRuby portability<br>
- 3 subprojects<br>
- Plugin/out<br>
- Precompilation<br>
- Swift core features</p>
<p>Auto-write barrier detection<br>
- write barrier needed for several GC algorithms.<br>
- automatic WB detection system</p>
<p>Generational GC<br>
1 but ref count</p>
<p>Multi-VM (MVM) Project<br>
- Multi VM in 1 process<br>
- Watch runs in parallel<br>
- High speed inter VM communication<br>
- Sponsored by Sun</p>
<p>Summary<br>
- CRuby/YARV is not &ldquo;best solution&rdquo;, but it is best for right now. But eventually, Rubinius is the future. Which just so happened to be the next session I attended&hellip;</p>

    </div>
  </div>

    <div class="footer">
  
  <div class="footer-social">
    
      <span class="social-icon social-icon-twitter">
        <a href="https://twitter.com/deadprogram" title="twitter" target="_blank" rel="noopener">
          <img src="/images/social/twitter.svg" width="24" height="24" alt="twitter"/>
        </a>
      </span>
    
      <span class="social-icon social-icon-github">
        <a href="https://github.com/deadprogram" title="github" target="_blank" rel="noopener">
          <img src="/images/social/github.svg" width="24" height="24" alt="github"/>
        </a>
      </span>
    
      <span class="social-icon social-icon-linkedin">
        <a href="https://www.linkedin.com/in/deadprogram/" title="linkedin" target="_blank" rel="noopener">
          <img src="/images/social/linkedin.svg" width="24" height="24" alt="linkedin"/>
        </a>
      </span>
    
  </div>
  
</div>
  </div>

  

  

  
  <script type="text/javascript" src="/js/bundle.min.575671c6da23c3563d465f9cfa3d2857fc0239531a2e8ea1fb6812017653b4d7.js"></script>
  

  
  

  
  
  
    
  

  


</body>
</html>